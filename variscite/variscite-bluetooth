#!/bin/sh -e
### BEGIN INIT INFO
# Provides:          variscite-bluetooth
# Required-Start:    $all
# Required-Stop:
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
### END INIT INFO
DESC=variscite-bluetooth

. /lib/lsb/init-functions

#Check if BT/WIFI is up
dmesg | grep -q "tuple 0x91" && {
	log_daemon_msg "BT found"
} || {
	log_daemon_msg "No BT found"
	exit 0
};

# Enable bluetooth chip
echo 178 >/sys/class/gpio/export
echo "out" > /sys/class/gpio/gpio178/direction
echo 0 > /sys/class/gpio/gpio178/value
sleep 1
echo 1 > /sys/class/gpio/gpio178/value
sleep 1;
# Attach UART to bluetooth stack
hciattach -t 10 -s 115200 /dev/ttymxc1 texas 3000000
sleep 1;
# Enable SCO over HCI
hcitool cmd 0x3f 0x210 0x01 0x00 0x00 0xff

exit 0
